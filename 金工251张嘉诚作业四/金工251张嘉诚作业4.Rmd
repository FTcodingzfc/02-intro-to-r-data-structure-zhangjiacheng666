---
title: "金工251张嘉诚作业4"
author: "张嘉诚"
date: "2025-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


#data.table是一个R包，提供了增强版的A，是用于在R中存储数据的标准数据结构,和数据框有联系，联系是他俩可以互相转换，区别数据框重点数据已经事先存储各向量中，域名和向量名一一对应，而table包各方面语法相对来说都比数据框简洁许多
```{r}
c = mtcars
data=data.frame(c)
as.data.table(data)
```
##使用as.data.table函数进行转换
```{r}
fwrite(data,'data.csv')
```
#导出
```{r}
matter = fread('data.csv')
head(matter,6)
```
#导入
#i表示索引行，j表示计算和索引，by表示分组
```{r}
narrow=as.data.table(mtcars)
narrow[1:3,]
```
#i的作用
```{r}
narrow[,.(mpg, cyl)]
```
#索引列
```{r}
narrow[,mean(mpg)]
```
#列计算
```{r}
narrow[1:10,mean(mpg),by=vs]
```
#by分组,执行顺序是先i确定行范围，再by分组，最后j进行平均值计算
```{r}
narrow[,.(mpg,vs)]
```
#引用变量
```{r}
narrow[,cxmshisb:=mpg+vs]
narrow[,.(mpg,vs,cxmshisb)]
```
#变量相加
```{r}
narrow[mpg>20]
narrow[1:3]
narrow[mpg>20 & vs==0]
```
#行逻辑向量筛选,整数索引
```{r}
narrow[,.(mpg,vs)]
narrow[,list(mpg)]
```
#列筛选
```{r}
narrow[c(1,2),c(3,4)]
narrow[,c('mpg')]
narrow[,1:3]
```
#综上数据框的筛选方法table包仍适用
```{r}
narrow[,list(mpg)]
```
#用list函数选单列仍是data.table
```{r}
narrow[,mpg]
```
#这样出来的是向量
```{r}
narrow[order(mpg,-cyl)]
```
#用order函数完成多列排序，-表示降序，默认升序
```{r}
narrow[vs==0][order(mpg,-cyl)]
```
#在i出可进行排序，其余不行，排序和筛选可同时进行
```{r}
narrow[,cxmshisb:=mpg+vs]
narrow[,.(mpg,vs,cxmshisb)]
```
#增加变量
```{r}
narrow[,mpg:=mpg^2]
```
#更改变量
```{r}
narrow[,c('findout','undeer'):=list(mpg^2,cyl*3)]
```
#添加多个变量
```{r}
narrow[
,.(sum(mpg),sum(cyl)),by=.(vs,am)
]
narrow[
,.(sum(mpg),sum(cyl)),keyby=.(vs,am)
]
```
#分组操作是把相同的内容聚为一个，by与keyby的区别在于keyby可以自动按分组中的变量排序。
```{r}
narrow[
,.(ywa=sum(mpg),xioam=sum(cyl)),by=.(vs,am)
][ywa>3000]
```
#分组和筛选
```{r}
bind3=narrow[,.SD]
class(bind3)
```
#.SD表示整个 data.table 数据集,数据结构为data。table型
```{r}
bind4=narrow[,.SD,by=vs]
class(bind3)
```
#数据结构为data。table型
```{r}
bind = narrow[,.N]
class(bind)
```
#.N表示统计行数，数据结构为整形
```{r}
bind2=narrow[,.N,by=vs]
class(bind2)
```
#经分组后则变为一个data.table型
```{r}
narrow[vs==1&am==1][,.(mpg_aver=mean(mpg),cyl_aver=mean(cyl))]
```
#链式操作，用于多条件选取数据，能更加简洁明了
```{r}
data1=data.table(id=c('1','2','3'),name=c('jano','bob','erick'))
data2=data.table(id=c('1','2','4'),ground=c('2000','4000','4024'))
test=merge(data1,data2,by='id')
test
```
#join操作第一种
```{r}
test1=data1[data2,on='id',nomatch = 0]
test1
```
#join操作第二种，区别在于，第二种更加便捷
```{r}
narrow1=narrow+1
narrow1
finger=rbindlist(list(narrow,narrow1))
finger
```
#bind操作
```{r}
BYD2=as.data.table(mtcars,keep.rownames = "model")
byd=melt(BYD2, id.vars = c('model','cyl'), measure.vars = c('disp','hp'), variable.name = "variable", value.name = "value")
byd
```
#melt操作即将宽格式转换成长格式
```{r}
dcast(byd, model+cyl~variable,,value.var = "value")
```
#cast操作长格式转为宽格式
